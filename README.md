# 犯罪予測マップ（WebCrimeMapPrediction）

愛知県警察が公開している[犯罪オープンデータ](https://www.pref.aichi.jp/police/anzen/toukei/opendata/seian-s/crimeopendata.html)と[オープンストリートマップ（MapBox）](https://www.openstreetmap.org/)を利用した犯罪予測のウェブアプリです．アーバンデータチャレンジ2020の応募作品として開発しました．

- 作品タイトル：犯罪オープンデータとオープンストリートマップを利用した犯罪予測マップ
- 製作者：向 直人（[椙山女学園大学](https://www.sugiyama-u.ac.jp/) / Code for Nagoya / UDC愛知ブロック）
- 作品のテーマ：防犯・防災
- 作品のタイプ：アプリケーション
- 応募部門：ビジネス・プロフェッショナル

## 作品概要

### 作品の目的

本作品は全国で発生する犯罪を予防することを目的としています．犯罪者を減らすのではなく，犯罪が起こりにくい街を設計するためのウェブアプリ「**犯罪予測マップ**」を開発しました．このアプリは対象地域の「道路形状」や「建物配置」などの特徴から，起こりやすい犯罪種別を予測することが可能となっており，犯罪種別ごとのきめ細やかな防犯対策の実現を支援します．

[令和2年警察白書 統計資料](https://www.npa.go.jp/hakusyo/r02/data.html)によると，愛知県は刑法犯の認知件数が49,956件と全国でワースト4位となっています（交通事故死者数が全国的に多いことでも有名です）．この数値を減らすことで，治安の向上だけでなく，地域の魅力を高めることに繋がり，地域経済の発展にも寄与すると考えています．

|県|認知件数|検挙件数|検挙人員|
|:----|:----|:----|:----|
|東京|104,664|34,309|24,902|
|大阪|84,672|22,074|15,561|
|埼玉|55,497|18,750|11,297|
|愛知|49,956|17,395|13,235|
|千葉|41,793|12,883|7,726|

### 予測手法とオープンデータ

犯罪の予測には **畳み込みニューラルネットワーク（Convolutional Neural Network: CNN）** を採用しています．CNNは画像認識が得意な深層学習の一つです．これまでの犯罪予測手法には，時空間のクラスタリングを利用した **STAC（Spatio-Temporal Analysis of Crime）** や，時空間を軸に犯罪発生の強度を推定する **Prospective Mapping** などが知られていますが，対象地域の道路や建物の形状に関する特徴量は考慮されていませんでした．これは，道路や建物などの幾何学的な形状から，犯罪に関連する特徴量を抽出することが難しかったからだと思われます．開発した犯罪予測マップは，対象地域の **地図画像（PNG画像）** をCNNに入力として与えることが大きな特徴です．これにより，犯罪に関連する幾何学的な特徴量を自動的にCNNが学習してくれます．

CNNの学習には愛知県警察が公開している[犯罪オープンデータ](https://www.pref.aichi.jp/police/anzen/toukei/opendata/seian-s/crimeopendata.html)を利用しました．犯罪オープンデータには，下記に示すように，愛知県で発生した犯罪に関する情報（罪名，手口，市区町村コード，都道府県，市区町村，町丁目，発生年月日，発生時など）で構成されています．2018年度と2019年度のデータ（レコード数：23125件）が公開されていますが，全てのレコードの罪名は **窃盗** であり，手口（犯罪種別）は，「部品ねらい」「ひったくり」「オートバイ盗」「車上ねらい」「自動販売機ねらい」「自動車盗」「自転車盗」の7種類ですが，ここでは，CNNの学習における速度や精度の観点から，「**車上ねらい（1000件）**」「**自動販売機ねらい（1000件）**」「**自動車盗（1000件）**」の3種類を抽出し，学習に用いることにします．

|罪名|手口|市区町村コード|都道府県|市区町村|町丁目|発生年月日|発生時|
|:----|:----|:----|:----|:----|:----|:----|:----|
|窃盗|車上ねらい|231045|愛知県|名古屋市西区|上堀越町４丁目|2019/5/13|19|
|窃盗|車上ねらい|231045|愛知県|名古屋市西区|香呑町４丁目|2019/5/23|20|
|窃盗|自動販売機ねらい|231045|愛知県|名古屋市西区|稲生町３丁目|2019/5/21|23|
|窃盗|自動販売機ねらい|231045|愛知県|名古屋市西区|稲生町３丁目|2019/6/8|19|
|窃盗|自動車盗|231029|愛知県|名古屋市東区|泉１丁目|2019/8/11|12|
|窃盗|自動車盗|231126|愛知県|名古屋市南区|立脇町３丁目|2019/4/15|9|

犯罪の発生位置は **町丁** までしか公開されていません（緯度・経度ではない）．そこで，[Mapbox](https://www.mapbox.com/)の[Geocoding API](https://docs.mapbox.com/api/search/geocoding/)を利用して，上記の住所文字列から **緯度・経度** を生成します．この情報は正確な発生位置ではありませんが，緯度・経度を中心とした地図画像を生成することで，周辺の道路や建物などの形状を知ることができます．繁華街や住宅街などで異なる特徴を示すことが期待できます．

|手口|緯度|経度|
|:----|:----|:----|
|車上ねらい|35.20388935|136.8788556|
|車上ねらい|35.20277102|136.8950937|
|自動販売機ねらい|35.20880135|136.896513|
|自動販売機ねらい|35.20880135|136.896513|
|自動車盗|35.17609753|136.9088932|
|自動車盗|35.09463333|136.9278315|

### 学習データ（地図画像）の生成

上記の緯度・経度を利用して地図画像を生成します．地図画像の生成には[Mapbox](https://www.mapbox.com/)の[Static Tiles API](https://docs.mapbox.com/api/maps/static-tiles/)を利用します．下記が生成された地図画像（256x256）であり，上記の6件の緯度・経度に対応しています（自動販売機狙いは同じ住所であるため画像も同じ）．

【車上ねらい】<br>
[![Image from Gyazo](https://i.gyazo.com/59232de9dfc083b5e86a06953b1e2de1.jpg)](https://gyazo.com/59232de9dfc083b5e86a06953b1e2de1)

【自動販売機ねらい】<br>
[![Image from Gyazo](https://i.gyazo.com/27735b563f2e0a1ba866a5d5cc629482.jpg)](https://gyazo.com/27735b563f2e0a1ba866a5d5cc629482)

【自動車盗】<br>
[![Image from Gyazo](https://i.gyazo.com/2f980c2ca90ea5483027a9afdad47170.jpg)](https://gyazo.com/2f980c2ca90ea5483027a9afdad47170)

地図画像はMapboxのスタイルを利用して，白，黒，緑，赤，青の5色で塗り分けられています．白は **道路領域**，黒は **背景領域** を表しています．また，**建物** は緑ですが，**駅**（train_station, station, transportation）だけは赤となっています．自動車関連の犯罪に関連が強いと思われる **駐車場** も建物データの一部ですが，駐車場であることを表す属性（parking）の設定が不十分であったため，苦肉の策で，建物ではなく駐車場を表すアイコンの位置に青の円を描画することにしました．残念ながらこの設定では，全ての駐車場をカバーできていないため，今後の改善点の一つです（良い方法があれば教えて下さい）．

|色|対象|
|:----|:----|
|白   | 道路領域（Road network）  |
|黒   | 背景領域  |
|緑   | 建物領域（Buildings）  |
|赤   | 駅（Buildings [train_station, station, transportation]）  |
|青   | 駐車場（Icon [parking]）  |

### CNNのモデル

上記の方法で生成した地図画像をCNNの学習データとして与え，「車上ねらい」「自動販売機ねらい」「自動車盗」の起こりやすさを出力させます．代表的なCNNのモデルである[AlexNet](https://en.wikipedia.org/wiki/AlexNet)を簡略化したネットワークを定義しました．ネットワークは，2種類の畳み込み層&プーリング層と，2種類の全結合層で構成されています．地図画像は64x64に縮小して与え，畳み込みとプーリングを経て，8x8サイズの48種類の特徴量（フィルタ）が抽出されます．この特徴量を結合して，3種類の犯罪種別の発生確率を出力します．

[![Image from Gyazo](https://i.gyazo.com/18ba0bde5c4a73db980eec52a7597d27.png)](https://gyazo.com/18ba0bde5c4a73db980eec52a7597d27)

### 実行結果

3つのサンプル画像を入力したときの予測結果を示します．

車上ねらいが実際に発生した地図画像です．予測の結果，車上ねらいが81.58%，自動車盗が18.36%となりました．地図画像内に駐車場が存在していることから，車上ねらい，また，自動車盗の可能性があると判断したと思われます．

緯度: 35.20277102 経度: 136.8950937<br>
[![Image from Gyazo](https://i.gyazo.com/60919daf1b4910fb9dc0a60d0b8df091.png)](https://gyazo.com/60919daf1b4910fb9dc0a60d0b8df091)<br>
車上ねらい: **81.58%**<br>
自動販売機ねらい: **0.05%**<br>
自動車盗: **18.36%**

自動販売機ねらいが実際に発生した地図画像です．予測の結果，自動販売機ねらいが99.95%となりました．先の画像に比べて，建物の密度が低いことが理由と考えられます．

緯度: 35.20880135 経度: 136.896513<br>
[![Image from Gyazo](https://i.gyazo.com/328b1e33ec0d4a9b67bd491856291848.png)](https://gyazo.com/328b1e33ec0d4a9b67bd491856291848)<br>
車上ねらい: **0.05%**<br>
自動販売機ねらい: **99.95%**<br>
自動車盗: **0.00%**

自動車盗が実際に発生した地図画像です．予測の結果，自動車盗が100%となりました．地図画像の左上に駅の存在が確認され，大きな通りの周辺であることが要因になっていると考えられます．

緯度: 35.17609753 経度: 136.9088932<br>
[![Image from Gyazo](https://i.gyazo.com/7450cd625f4eceae8b16c4f09cc27667.png)](https://gyazo.com/7450cd625f4eceae8b16c4f09cc27667)<br>
車上ねらい: **0.00%**<br>
自動販売機ねらい: **0.00%**<br>
自動車盗: **100.00%**

### モデルの評価

CNNのモデルの精度を評価します．データセット（3,000件）に含まれる8割のデータ（2,400件）を学習，残りの2割のデータ（6,00件）を評価に用いました．下図は損失関数（クロスエントロピー誤差）と正解率の推移です．学習データに対しては，損失が順調に減少し，正解率は最終的に **82.25%** まで向上しました．一方で，評価データに対しては，損失の減少は緩やかで，最終的な正解率は **50.66%** となり，十分な精度には到達できませんでした．しかし，正解率の一定の向上が認められたことから，道路や建物の幾何形状が犯罪種別に関係していることが示されました．今後，時間軸など他の要素をモデルに組み込むことで正解率の向上を目指したいと考えています．

<a href="https://gyazo.com/a6952ca4d9c4f07e654877db8c942eda"><img src="https://i.gyazo.com/a6952ca4d9c4f07e654877db8c942eda.png" alt="Image from Gyazo" width="400"/></a>

<a href="https://gyazo.com/9c8c27874dd7b951b91f25232272c031"><img src="https://i.gyazo.com/9c8c27874dd7b951b91f25232272c031.png" alt="Image from Gyazo" width="400"/></a>

### デモ

上記のモデルをウェブアプリ「犯罪予測マップ」として再構築しました．任意の地域に対して，犯罪種別の起こりやすさ予測することが可能です．

[![](https://i.gyazo.com/abd58f6320628475f27fb60f89580885.jpg)](http://www.youtube.com/watch?v=YXLXWoVWAeE "")

## 作品の実用度

本作品は発生する犯罪の予防を目的としています．犯罪者を減らすのではなく，犯罪が起こりにくい街づくりをサポートすることが狙いです．利用者はウェブアプリで対象地域を選択するだけで，起こりやすい犯罪種別を知ることが可能であり，きめ細やかな犯罪予防に繋がります．実験の結果，予測の精度は50.66%と決して高くないことが分かりましたが，道路や建物の幾何形状が犯罪に影響を及ぼすことは明らかであり，今後，様々な情報を追加することで，より高い精度の予測が実現できると考えています．

## 作品の完成度

本作品はウェブアプリとして実装されており，ウェブで公開することで誰もが利用可能です．地図を選択するというシンプルなインターフェイスで構成され，複雑な操作は不要であることから，コンピュータに詳しくない人でも，気軽に体験することができます．また，CNNのモデルを置き換えることで，予測精度の向上だけでなく，犯罪以外の用途にも応用が可能です．今回，学習に用いたデータは愛知県だけですが，今後は他県のデータも取り入れることで，地域の特性も考慮することが可能になると考えています．

## 作品の挑戦度

本作品は最先端のAI技術であるCNNを利用して，地図画像を学習させるという試みに挑戦しています．これまでの犯罪予測手法とは，全く異なるアプローチに基づいています．また，愛知県警が提供している犯罪オープンデータを利用して，学習用のデータセットを生成しており，オープンデータを積極的に活用した作品でもあります．これまでにもCNNを活用したサービスは数多く提供されていますが，CNNと地図と組み合わせたウェブアプリは独創的だと思っています．

## ビジネス・プロフェッショナル部門でのPR

畳み込みニューラルネットワークが画像認識に対して高い精度を示すことは知られていますが，地図画像を学習させるという試みは学術的にも新規性があると思っています．残念ながら予測精度は50%程度と高いとは言えませんが，このアプローチを発展させることで，交通事故や地価変動など，地形情報に関連した対象を的確に予測することが可能であり，産業界との連携も視野に入ると思います．

## 実行方法

[Python v3.x](https://www.python.jp/)で開発しました．アプリの実行には下記のライブラリが必要となりますので，pipコマンドなどを利用して導入してください．

- [Folium](https://python-visualization.github.io/folium/) MapBoxで生成した地図画像をダウンロード
- [PyTorch](https://pytorch.org/) 深層学習のフレームワーク
- [Flask](https://flask.palletsprojects.com/en/1.1.x/) ウェブアプリケーションのフレームワーク

レポジトリをダウンロード（またはクローン）したら，下記のコマンドを実行してください．

```
$ python WebCrimeMap.py
```

ウェブアプリが起動したら，ブラウザで http://127.0.0.1:5000/ にアクセスしてください．

### 重要
MapBox APIにアクセスするための **API_KEY** は公開することが出来ないため，GitHubレポジトリには含まれていません．UDCの審査に際しては，個別に情報を含めたファイル（secret.json）を提供しますので，開発者の向までお知らせください．アクセスが基準を超えると料金が発生してしまうため，ご利用の際はご注意頂けたらと思います．

## データセット

愛知県の[犯罪オープンデータ](https://www.pref.aichi.jp/police/anzen/toukei/opendata/seian-s/crimeopendata.html)を基に独自に生成したCNN用のデータセットです．データセットには，HTMLファイル，地図画像（PNG画像），犯罪データ（JSONファイル）が含まれています．

### [aichi-crime-map-700.zip](https://drive.google.com/file/d/1p7yFhjo7hpNHDjhtf-tFxX_jV9s76XZc/view?usp=sharing)

テスト用のデータセットです．サンプル数はN=700です．

- 部品ねらい 100
- ひったくり 100
- オートバイ盗 100
- 車上ねらい 100
- 自動販売機ねらい 100
- 自動車盗 100
- 自転車盗 100

### [aichi-crime-map-6235.zip](https://drive.google.com/file/d/1p2Tk37pzn6-whtuKfJeNPx8Let3EhgJZ/view?usp=sharing)

犯罪予測マップの学習に用いたデータセットです．サンプル数はN=6235です．

- 部品ねらい 1000
- ひったくり 235
- オートバイ盗 1000
- 車上ねらい 1000
- 自動販売機ねらい 1000
- 自動車盗 1000
- 自転車盗 1000
